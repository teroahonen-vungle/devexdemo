name: Push to devel

on:
  push:
    branches: [ devel ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
jobs:
  package:
    name: Compile & Package
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Get commit SHA
      id: commit_id
      run: echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"

    - name: Setup Java
      uses: actions/setup-java@v1
      with:
        java-version: 11
   
    - name: Compile & Package
      run: mvn -ntp --skipTest -B package
  
  unittest:
    name: Unit tests
    runs-on: ubuntu-latest
    needs: compile
    steps:
    - uses: actions/checkout@v2

    - name: Get commit SHA
      id: commit_id
      run: echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"

    - name: Setup Java
      uses: actions/setup-java@v1
      with:
        java-version: 11
   
    - name: Compile & Package
      run: mvn -ntp -B test
  sonar:
    name: Sonarqube
    runs-on: ubuntu-latest
    needs: compile
    steps:
    - uses: actions/checkout@v2

    - name: Get commit SHA
      id: commit_id
      run: echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"

    - name: Setup Java
      uses: actions/setup-java@v1
      with:
        java-version: 11
   
    - name: SonarCloud Scan
      uses: sonarsource/sonarcloud-github-action@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONARCLOUD_URL: ${{ secrets.SONARCLOUD_URL }}

    